---
layout: post
title:  "Resource Manager"
date:   2014-12-07 18:25:31
tags : [pl__myApps]

---
# 项目资源管理器

![](http://geequlim.qiniudn.com/QQ20141207-1.png)

####此工具使用SG2D跨平台游戏引擎和Walnut扩展制作，生成简单的字符键值对照xml文件，制作目的是方便资源文件路径和多语言文本管理。提供Window、Mac OSX和Android三个平台版本支持。

###工具特点

* 支持使用ID获取字符串和文件路径，在各IDE中代码会提示键名供索引。

* Walnut提供SG2D引擎的解析代码，请参看Walnut::Res::ResHelper。另外基于TinyXml的解析代码请在文章后面的下载区获取。

* 添加键值对表。支持添加文本，URL和其他类型的键值对。文本键值对兼容Android项目，导入Android项目后便可通过R类常量来获取字符串。

* 生成项目依赖资源文件的索引，指定资源目录和资源搜索起始目录（资源目录必须是资源搜索起始目录的子孙目录）并勾选生成资源索引复选框，便会将资源索引信息保存在资源目录下的resources.xml文件中。

* 同步各平台项目之间依赖的资源文件，拷贝源目录中的所有子孙文件复制到下面的各平台目标路径中。

###使用说明：

* 资源目录：工具生成文件路径索引时搜索的目录。如“Resources/res“则会在生成资源索引时对res目录下的所有文件生索引。**注意此目录下不能包含任何中文名称的文件和目录**。点击**“生成搜索引文件”**按钮会在此目录下生成**“resources.xml”**索引文件

* 资源搜索目录：值应用程序呢的工作目录，必须是包含*资源目录*的目录。如Apple项目中的“Resources”目录、Win32项目中的工作目录

* 代码目录：点击**“生成搜索引文件”**按钮会在此目录下生成**“resources.h”**索引头文件，该头文件中定义了各个资源和字符串的键名和在resources.xml文件中id值

* **键名称需符合标识符命名规范，不得重复**,可以用数字开头[^1]

* 如果需要生成资源文件的路径索引对照，则勾选左下角的**生成资源索引**复选框

* 要删除键值对表，按下鼠标左键拖动选中键名会出现**“删除”**按钮，点击删除即可删除

* 点击同步资源按钮即可进入资源拷贝界面

* 生成索引会在resources.h中定义在命名空间R中

###SG2D引擎使用方法：
1. 将工具生成的resources.h添加到项目中并在stdafx.h头文件中加入如下代码

        #include "res/ResHelper.h"
        #include "resources.h"
        extern Walnut::Res::ResHelper *resHelper;

2. 将工具生成的resources.xml文件放在项目资源目录下如“Resources/res/resources.xml”

3. 在第一次使用资源前创建ResHelper对象，如在Mac OSX项目的AppDelegate.cpp文件中添加如下代码：

        #include "res/ResHelper.h"
        Walnut::Res::ResHelper * resHelper = NULL;

        void cppInitalizeApplication()
        {
            LocalFile file("res/StoryPlayer/ui/resources.xml", File::foShareRead);
            resHelper = new Walnut::Res::ResHelper(file);
            
            static const char *defFontName = "font1";
            TextPainter::registerFontFile(defFontName, "font1.ttf");
            
            FontDescription::DefaultFontDescription.setFont(defFontName, 12, 0xFF000000, FontDescription::Regular, true);
            RegisterAppleColorEmojiExtention();
            RegisterUIClasses();
        }

4. 在项目中使用获取文本，如在Mac OSX项目中的AppDelegate.mm文件中加载名称为“app_name”的文本来设置窗口标签

        -(void*)createMainWindow
        {
            OSXRenderWindow* renderWindow = (OSXRenderWindow*)cppCreateMainWindow();
            NSWindow *wnd = (NSWindow*)renderWindow->hostWnd();
            //设置窗口标题中显示全屏按钮
            [wnd setCollectionBehavior:NSWindowCollectionBehaviorFullScreenPrimary];
            //设置窗口标题文字,通过resources.h头文件中命名空间R的索引获取字符串
            renderWindow->setWndTitle( (*resHelper)[R::string_app_name] );
        
            return renderWindow;
        }
5.在应用程序结束时记得释放resHelper对象的内存：
        
        void ApplicationDelegate::onStop(SG2D::Stage * pStage)
        {
            Walnut::uninitialize();
            if(resHelper)
        	{
        	    resHelper->release();
        	    resHelper = NULL;
        	}
        }

###下载：
* [点此下载此工具]( http://pan.baidu.com/s/1c09xwlU)

* 解析代码：等待修正上传






[^1]:标识符命名规范
>标识符由大小写字母, 下划线, 数字, $符号组成.  
>
> 开头可以是大小写字母, 下划线, 和$符号.(数字不能开头)  
> 
> 标识符长度没有限制  
> 
> 标识符不能是关键子和保留字  
> 
> 标识符的命名最好能反映出其作用  
> 
> 对字母的大小写有严格的要求.      
> 
> 所有自定义标识符需全部遵循标识符的命名规范.  